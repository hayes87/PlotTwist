<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Voice Recognition</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-panel { 
            border: 2px solid #007bff; 
            padding: 20px; 
            margin: 20px 0; 
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .test-button { 
            background-color: #28a745; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        .test-button:hover { background-color: #218838; }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px;
        }
        .status.success { background-color: #d4edda; color: #155724; }
        .status.error { background-color: #f8d7da; color: #721c24; }
        .status.info { background-color: #d1ecf1; color: #0c5460; }
        .answer-container { margin: 20px 0; }
        #answer-input { 
            width: 100%; 
            padding: 10px; 
            font-size: 16px; 
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .console-output {
            background-color: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üîß Debug do Sistema de Reconhecimento de Voz</h1>
    
    <div class="debug-panel">
        <h3>üîç Status do Sistema</h3>
        <div id="system-status" class="status info">Carregando...</div>
        
        <h3>üß™ Testes Dispon√≠veis</h3>
        <button class="test-button" onclick="runDiagnostics()">üîç Diagn√≥stico Completo</button>
        <button class="test-button" onclick="testMicrophonePermission()">üé§ Testar Permiss√£o</button>
        <button class="test-button" onclick="testVoiceRecognition()">üó£Ô∏è Testar Reconhecimento</button>
        <button class="test-button" onclick="simulateGameStart()">üéÆ Simular In√≠cio do Jogo</button>
        <button class="test-button" onclick="toggleGroupMode()">üë• Alternar Modo Grupo</button>
        <button class="test-button" onclick="clearConsole()">üßπ Limpar Console</button>
    </div>
    
    <div class="answer-container">
        <h3>üìù Campo de Resposta (Simula√ß√£o)</h3>
        <input type="text" id="answer-input" placeholder="Suas respostas aparecer√£o aqui...">
    </div>
    
    <div class="debug-panel">
        <h3>üìä Console Output</h3>
        <div id="console-output" class="console-output"></div>
    </div>

    <!-- Mock functions -->
    <script>
        let groupModeActive = false;
        
        // Mock notification system
        window.showNotification = function(message, type, autoHide, duration) {
            logToConsole(`üîî NOTIFICATION [${type}]: ${message}`, 'notification');
        };
        
        // Mock submit function
        window.submitAnswer = function() {
            const input = document.getElementById('answer-input');
            logToConsole(`üì§ SUBMIT: "${input.value}"`, 'submit');
            input.value = '';
        };
        
        // Mock game state
        window.gameState = {
            isProcessingAnswer: false
        };
        
        function logToConsole(message, type = 'log') {
            const console_output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'log': '#d4d4d4',
                'error': '#f14c4c',
                'warn': '#ffcc02',
                'info': '#3794ff',
                'success': '#23d18b',
                'notification': '#ff6b6b',
                'submit': '#ffa500'
            };
            
            const color = colors[type] || colors.log;
            console_output.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            console_output.scrollTop = console_output.scrollHeight;
        }
        
        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
        }
        
        function updateSystemStatus() {
            const statusDiv = document.getElementById('system-status');
            
            if (window.voiceRecognition) {
                if (window.voiceRecognition.isSupported) {
                    statusDiv.innerHTML = '‚úÖ Sistema de voz carregado e funcionando';
                    statusDiv.className = 'status success';
                } else {
                    statusDiv.innerHTML = '‚ùå Navegador n√£o suporta reconhecimento de voz';
                    statusDiv.className = 'status error';
                }
            } else {
                statusDiv.innerHTML = '‚ö†Ô∏è Sistema de voz n√£o encontrado';
                statusDiv.className = 'status error';
            }
        }
        
        function runDiagnostics() {
            logToConsole('üîç Iniciando diagn√≥stico completo...', 'info');
            
            // Check browser support
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                logToConsole('‚úÖ Navegador suporta Web Speech API', 'success');
            } else {
                logToConsole('‚ùå Navegador N√ÉO suporta Web Speech API', 'error');
                return;
            }
            
            // Check voiceRecognition instance
            if (window.voiceRecognition) {
                logToConsole('‚úÖ Inst√¢ncia voiceRecognition encontrada', 'success');
                logToConsole(`   üìä isSupported: ${window.voiceRecognition.isSupported}`, 'info');
                logToConsole(`   üìä microphonePermissionGranted: ${window.voiceRecognition.microphonePermissionGranted}`, 'info');
                logToConsole(`   üìä isListening: ${window.voiceRecognition.isListening}`, 'info');
                logToConsole(`   üìä gameActive: ${window.voiceRecognition.gameActive}`, 'info');
                logToConsole(`   üìä continuousMode: ${window.voiceRecognition.continuousMode}`, 'info');
                logToConsole(`   üìä confidenceThreshold: ${window.voiceRecognition.confidenceThreshold}`, 'info');
                logToConsole(`   üìä groupMode: ${window.voiceRecognition.groupMode}`, 'info');
                
                // Check recognition object
                if (window.voiceRecognition.recognition) {
                    logToConsole('‚úÖ Objeto SpeechRecognition criado', 'success');
                } else {
                    logToConsole('‚ùå Objeto SpeechRecognition N√ÉO encontrado', 'error');
                }
                
                // Check DOM elements
                if (window.voiceRecognition.answerInput) {
                    logToConsole('‚úÖ Campo de resposta encontrado', 'success');
                } else {
                    logToConsole('‚ö†Ô∏è Campo de resposta n√£o encontrado', 'warn');
                }
                
            } else {
                logToConsole('‚ùå Inst√¢ncia voiceRecognition N√ÉO encontrada', 'error');
            }
            
            // Check global functions
            const functions = ['initializeVoiceForGame', 'isVoiceActive', 'getVoiceStatus'];
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    logToConsole(`‚úÖ Fun√ß√£o ${funcName} dispon√≠vel`, 'success');
                } else {
                    logToConsole(`‚ùå Fun√ß√£o ${funcName} N√ÉO dispon√≠vel`, 'error');
                }
            });
            
            logToConsole('üîç Diagn√≥stico completo finalizado', 'info');
            updateSystemStatus();
        }
        
        async function testMicrophonePermission() {
            logToConsole('üé§ Testando permiss√£o do microfone...', 'info');
            
            if (!window.voiceRecognition) {
                logToConsole('‚ùå voiceRecognition n√£o dispon√≠vel', 'error');
                return;
            }
            
            try {
                const permission = await window.voiceRecognition.checkMicrophonePermission();
                logToConsole(`üìä Status da permiss√£o: ${permission}`, 'info');
                
                if (permission === true) {
                    logToConsole('‚úÖ Permiss√£o concedida', 'success');
                } else if (permission === false) {
                    logToConsole('‚ùå Permiss√£o negada', 'error');
                } else {
                    logToConsole('‚ö†Ô∏è Permiss√£o ainda n√£o decidida', 'warn');
                    
                    // Solicitar permiss√£o
                    logToConsole('üé§ Solicitando permiss√£o...', 'info');
                    await window.voiceRecognition.requestMicrophonePermission();
                    
                    // Verificar novamente
                    const newPermission = await window.voiceRecognition.checkMicrophonePermission();
                    logToConsole(`üìä Nova status da permiss√£o: ${newPermission}`, 'info');
                }
            } catch (error) {
                logToConsole(`‚ùå Erro ao testar permiss√£o: ${error.message}`, 'error');
            }
        }
        
        function testVoiceRecognition() {
            logToConsole('üó£Ô∏è Testando reconhecimento de voz...', 'info');
            
            if (!window.voiceRecognition) {
                logToConsole('‚ùå voiceRecognition n√£o dispon√≠vel', 'error');
                return;
            }
            
            if (!window.voiceRecognition.isSupported) {
                logToConsole('‚ùå Reconhecimento de voz n√£o suportado', 'error');
                return;
            }
            
            // Start continuous listening
            logToConsole('üé§ Iniciando escuta cont√≠nua...', 'info');
            window.voiceRecognition.gameActive = true;
            window.voiceRecognition.startContinuousListening();
            
            // Check status after a delay
            setTimeout(() => {
                if (window.voiceRecognition.isListening) {
                    logToConsole('‚úÖ Escuta ativa - fale algo para testar!', 'success');
                } else {
                    logToConsole('‚ùå Falha ao iniciar escuta', 'error');
                }
            }, 2000);
        }
        
        function simulateGameStart() {
            logToConsole('üéÆ Simulando in√≠cio do jogo...', 'info');
            
            if (!window.voiceRecognition) {
                logToConsole('‚ùå voiceRecognition n√£o dispon√≠vel', 'error');
                return;
            }
            
            // Call the game integration function
            if (typeof window.initializeVoiceForGame === 'function') {
                const result = window.initializeVoiceForGame();
                logToConsole(`üìä Resultado da integra√ß√£o: ${result}`, 'info');
            }
            
            // Start game listening
            if (window.voiceRecognition.startGameListening) {
                window.voiceRecognition.startGameListening();
                logToConsole('üé§ Reconhecimento do jogo iniciado', 'success');
            }
            
            // Check status
            setTimeout(() => {
                const status = window.getVoiceStatus ? window.getVoiceStatus() : 'unknown';
                logToConsole(`üìä Status do jogo: ${status}`, 'info');
            }, 1000);
        }
        
        function toggleGroupMode() {
            if (!window.voiceRecognition) {
                logToConsole('‚ùå voiceRecognition n√£o dispon√≠vel', 'error');
                return;
            }
            
            groupModeActive = !groupModeActive;
            
            if (window.voiceRecognition.setGroupMode) {
                window.voiceRecognition.setGroupMode(groupModeActive);
                logToConsole(`üë• Modo grupo: ${groupModeActive ? 'ATIVADO' : 'DESATIVADO'}`, 'info');
            } else {
                logToConsole('‚ùå Fun√ß√£o setGroupMode n√£o dispon√≠vel', 'error');
            }
        }
        
        // Intercept console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            logToConsole('LOG: ' + args.join(' '), 'log');
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logToConsole('ERROR: ' + args.join(' '), 'error');
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            logToConsole('WARN: ' + args.join(' '), 'warn');
            originalWarn.apply(console, args);
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            logToConsole('üöÄ Debug page loaded', 'info');
            
            // Wait for voice recognition to load
            let attempts = 0;
            const checkInterval = setInterval(() => {
                attempts++;
                if (window.voiceRecognition) {
                    clearInterval(checkInterval);
                    logToConsole('‚úÖ Sistema de voz detectado!', 'success');
                    updateSystemStatus();
                    runDiagnostics();
                } else if (attempts >= 10) {
                    clearInterval(checkInterval);
                    logToConsole('‚ùå Timeout: Sistema de voz n√£o carregado', 'error');
                    updateSystemStatus();
                }
            }, 1000);
        });
    </script>
    
    <!-- Load voice recognition -->
    <script src="voice-recognition.js"></script>
    <script src="debug-voice.js"></script>
</body>
</html>
